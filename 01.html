<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/index.css">
</head>

<body>
    <!-- 最外侧 -->
    <div class="outer">
        <!-- 尚品汇的头部区域 -->
        <header>
            <!-- 灰色区域 -->
            <div class="header-outer">
                <div class="header">
                    <div class="left">
                        <span>尚品汇欢迎您 请</span>
                        <a href=":;javaScript">登录</a>
                        <a href=":;javaScript">免费注册</a>
                    </div>
                    <div class="right">
                        <a href=":;javaScript">我的订单</a>
                        <a href=":;javaScript">我的购物车</a>
                        <a href=":;javaScript">我的尚品汇</a>
                        <a href=":;javaScript">尚品汇会员</a>
                        <a href=":;javaScript">企业采购</a>
                        <a href=":;javaScript">关注尚品汇</a>
                        <a href=":;javaScript">合作招聘</a>
                        <a href=":;javaScript">商家后台</a>
                    </div>
                </div>
            </div>
            <!-- logo区域 -->
            <div class="logo-outer">
                <h1 class="left">
                    <img src="./images/Logo.png" alt="">
                </h1>
                <div class="right">
                    <input type="text">
                    <button>搜索</button>
                </div>
            </div>
        </header>
        <div class="allnav_outer">
            <div class="allnav">
                <h2>所有商品分类</h2>
                <nav>
                    <a href="javascript:;">服装城</a>
                    <a href="javascript:;">美妆馆</a>
                    <a href="javascript:;">尚品汇超市</a>
                    <a href="javascript:;">全球购</a>
                    <a href="javascript:;">闪购</a>
                    <a href="javascript:;">团购</a>
                    <a href="javascript:;">有趣</a>
                    <a href="javascript:;">秒杀</a>
                </nav>
            </div>
        </div>
        <section class="con">
            <div class="conPoint">
                <a href="javascript:;">手机、数码、通讯手机</a>
                <a href="javascript:;">Apple苹果</a>
                <a>iphone 6S系类</a>
            </div>
            <div class="mainCon">
                <div class="previewArea">
                    <div class="preview">
                        <!-- 小图区域 -->
                        <div class="smallArea">
                            <img src="./images/s1.png" alt="">
                            <!-- 蒙版区域 -->
                            <!-- <div class="mask"></div> -->
                        </div>
                        <!-- 大图区域 -->
                        <!-- <div class="bigArea">
                            <img src="./images/b1.png" alt="">
                        </div> -->
                    </div>
                    <div class="prescroll">
                        <p class="left">&lt;</p>
                        <div class="listOut">
                            <ul class="list">
                                <!-- 动态加载图片资源 -->
                            </ul>
                        </div>
                        <p class="right">&gt;</p>
                    </div>
                </div>
                <div class="detailArea">
                    <div class="priceArea">
                        <!-- 动态加载数据 -->
                    </div>
                    <div class="chooseInsert">
                    </div>
                    <div class="chooseArea">
                        
                    </div>
                    <div class="goodsNum">
                        <div class="num">
                            <input type="text" value="1">
                            <button class="plus">+</button>
                            <button class="mins">-</button>
                        </div>
                        <div class="addCart">加入购物车</div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</body>
<script src="./js/data.js"></script>
<script>
    window.addEventListener("DOMContentLoaded", function () {
        var imgIndex = 0;
        // 放大镜蒙版区域
        magnify();
        function magnify() {
            var oSmallArea = document.querySelector('.smallArea');
            var oPreview = document.querySelector('.preview');
            oPreview.onmouseenter = function () {
                var data = goodData.imgsrc;
                // 创建蒙版区域
                var oMask = document.createElement("div");
                oMask.classList.add("mask");
                oSmallArea.appendChild(oMask);
                // 大图区域
                var oBigArea = document.createElement("div");
                oBigArea.classList.add("bigArea")
                var oImg = new Image();
                oImg.src = data[imgIndex].b;
                oBigArea.appendChild(oImg);
                oPreview.appendChild(oBigArea);

                // 获取元素
                oPreview.onmousemove = function (e) {
                    // 计算距离
                    var move = {
                        x: e.clientX - oSmallArea.getBoundingClientRect().left - oMask.offsetWidth / 2,
                        y: e.clientY - oSmallArea.getBoundingClientRect().top - oMask.offsetHeight / 2,
                    }

                    // 计算临界值
                    if (move.x >= oSmallArea.clientWidth - oMask.offsetWidth) {
                        move.x = oSmallArea.clientWidth - oMask.offsetWidth
                    } else if (move.x <= 0) {
                        move.x = 0
                    }
                    if (move.y >= oSmallArea.clientHeight - oMask.offsetHeight) {
                        move.y = oSmallArea.clientHeight - oMask.offsetHeight
                    } else if (move.y <= 0) {
                        move.y = 0
                    }
                    // 进行赋值
                    oMask.style.left = move.x + "px";
                    oMask.style.top = move.y + "px";

                    // 计算比例
                    var scale = (oSmallArea.clientWidth - oMask.offsetWidth) / (oBigArea.clientWidth - oImg.offsetHeight);
                    var bigMove = {
                        x: move.x / scale,
                        y: move.y / scale
                    }
                    //图片移动的距离
                    oImg.style.left = bigMove.x + "px";
                    oImg.style.top = bigMove.y + "px";

                }
                // 当鼠标离开时
                oPreview.onmouseleave = function () {
                    oPreview.onmousemove = null;
                    oPreview.onmouseleave = null;
                    oSmallArea.removeChild(oMask);
                    oPreview.removeChild(oBigArea);
                }
            }
        }
        // 加载资源
        loadData();
        function loadData() {
            var oList = document.querySelector('.listOut .list');
            var data = goodData.imgsrc;
            data.forEach((item, index) => {
                var newLi = document.createElement("li");
                var newImg = new Image();
                newImg.src = item.s;
                newLi.appendChild(newImg);
                oList.appendChild(newLi)
            })

        }
        // 点击左右键小图开始移动左右移动俩张
        smallMove();
        function smallMove() {
            var oLeft = document.querySelector('.prescroll .left');
            var oRight = document.querySelector('.prescroll .right');
            var oLi = document.querySelectorAll('.listOut .list li');
            var oListOut = document.querySelector('.listOut');
            var oList = document.querySelector('.listOut .list');
            // 这里计算可以移动的总距离要使用个数进行计算，使用list的宽度不准确
            var allMove = (oLi.length - 5) * oLi[0].offsetWidth;
            var everyMove = oLi[0].offsetWidth * 2;

            oRight.onclick = function () {
                if (allMove - oListOut.scrollLeft >= everyMove) {
                    oListOut.scrollLeft += everyMove;
                    console.log(oListOut.scrollLeft + "右键");

                } else {
                    oListOut.scrollLeft = allMove;
                    console.log(oListOut.scrollLeft + "右键最后");
                }
            }
            oLeft.onclick = function () {
                oListOut.scrollLeft -= everyMove;
            }
        }
        // 点击小图上面的放大镜区域跟着进行变化
        clickSmall();
        function clickSmall() {
            var oImg = document.querySelectorAll('.listOut .list li img');
            var oSmallArea = document.querySelector('.preview .smallArea img');
            var data = goodData.imgsrc;
            oImg.forEach((item, index) => {
                item.onclick = function () {
                    oSmallArea.src = data[index].b;
                    imgIndex = index;
                }
            })
        }
        // 动态加载
        priceAreaData();
        function priceAreaData() {
            var data = goodData.goodsDetail;
            var oPriceArea = document.querySelector('.priceArea');
            oPriceArea.innerHTML = `<h3 class="title">${data.title}</h3>
                        <p class="con">${data.recommend}</p>
                        <div class="price">
                            <div class="priceDetail">
                                <p>价&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;格</p>
                                <p>￥ <span>${data.price}</span> 元</p>
                            </div>
                            <div class="buy">
                                <p>促&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;销</p>
                                <p><span>${data.promoteSales.type}</span>${data.promoteSales.content}</p>
                            </div>
                        </div>
                        <div class="support">
                            <div class="supportDetail">
                                <p>支&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;持</p>
                                <p>${data.support}</p>
                            </div>
                            <div class="address">
                                <p>配&nbsp;送&nbsp;至</p>
                                <p>${data.address}</p>
                            </div>
                        </div>`;
        }
        chooseAreaData();
        function chooseAreaData() {
            var data = goodData.goodsDetail;
            var oChooseArea = document.querySelector('.chooseArea');
            data.crumbData.forEach((item, index) => {
                var oDL = document.createElement("dl");
                var oDt = document.createElement("dt");
                oDt.innerHTML = item.title;
                oDL.appendChild(oDt);
                oChooseArea.appendChild(oDL);
                item.data.forEach((item,index)=>{
                    var oDd = document.createElement("dd");
                    oDd.innerHTML = item.type;
                    oDd.dataset.changePrice = item.changePrice;
                    oDL.appendChild(oDd);
                })
            })
        }

    })
</script>

</html>